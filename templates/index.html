<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish Freshness Detector</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.3/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://api.fontshare.com/v2/css?f[]=archivo@400&f[]=clash-display@600&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body {
        font-family: 'Poppins', sans-serif; ;
        background-color: #000000;
        color: #E0E0E0;
    }

    h1 {
        font-family: 'Poppins', sans-serif; ;
        color: #FFFFFF;
        font-size: 3.5rem;
        text-transform: uppercase;
        margin-top: 1rem;
        margin-bottom: 2rem;
        text-align: left;
    }

    button {
        background-color: #8B0000;
        color: #FFFFFF;
        font-weight: bold;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
        box-shadow: 0 8px 16px rgba(255, 255, 255, 0.2);
    }

    .tab-button {
        background: linear-gradient(to bottom, #4C0000, #8B0000);
        color: #FFFFFF;
        transition: background 0.3s, box-shadow 0.3s;
        font-family: 'Poppins', sans-serif; /* Apply Poppins font */
    }



    .tab-button:hover {
        box-shadow: 0 6px 12px rgba(255, 255, 255, 0.1);
    }

    .tab-button:nth-child(1) { /* Real-time Tab */
        background: linear-gradient(to bottom, #2E0000, #4C0000);
    }

    .tab-button:nth-child(2) { /* Upload Tab */
        background: linear-gradient(to bottom, #3A0000, #5C0000);
    }

    .tab-button:nth-child(3) { /* Capture Tab */
        background: linear-gradient(to bottom, #480000, #7C0000);
    }

    .tab-button:nth-child(4) { /* Batch Tab */
        background: linear-gradient(to bottom, #600000, #8B0000);
    }

    .tab-button.active {
        background: linear-gradient(to bottom, #FF3B3B, #B22222);
    }

    .info-icon {
        display: inline-block;
        width: 20px;
        height: 20px;
        background-color: #B22222;
        color: white;
        font-size: 12px;
        font-weight: bold;
        text-align: center;
        line-height: 20px;
        border-radius: 50%;
        cursor: pointer;
        position: relative;
    }

    .info-icon::after {
        content: attr(data-info);
        position: absolute;
        left: 110%; /* Adjust tooltip position */
        top: 50%;
        transform: translateY(-50%);
        background: #2A2A2A;
        color: #FFB6C1;
        padding: 8px;
        border-radius: 5px;
        font-size: 12px;
        white-space: nowrap;
        box-shadow: 0 4px 10px rgba(255, 255, 255, 0.2);
        visibility: hidden; /* Hide by default */
        opacity: 0;
        transition: opacity 0.2s, visibility 0.2s;
        z-index: 1000;
    }

    .info-icon:hover::after {
        visibility: visible; /* Show on hover */
        opacity: 1;
    }
    input, select {
        background-color: #2C2C2C;
        color: #FFFFFF;
        border: 1px solid #B22222;
    }

    pre {
        background-color: #1F1F1F;
        color: #FF7F7F;
    }
    

    .rounded-lg, .rounded-2xl, .rounded-3xl {
        background-color: #1A1A1A;
        box-shadow: 0 4px 8px rgba(255, 255, 255, 0.1);
    }

    .chart-container {
        position: relative;
        height: 16rem; /* Ensure enough space for charts */
    }

    .pie-chart-container {
        position: relative;
        height: 12rem; /* Adjust the height of the pie chart */
    }
</style>



</head>
<body>

<div class="min-h-screen grid grid-cols-1 md:grid-cols-3 gap-6 p-6">
    <!-- Center Column: Input Forms (Moved to the Left) -->
    <div class="bg-[#1E1E1E] shadow-box rounded-3xl p-6">
        <h2 class="text-center text-4xl font-bold mb-4">Input Forms</h2>
        <form>
            <div class="mb-4">
                <label for="fishName" class="block text-sm font-medium">Fish Name</label>
                <input type="text" id="fishName" placeholder="Enter fish name" class="mt-1 block w-full px-3 py-2 rounded-md">
            </div>
            <div class="mb-4">
                <label for="fishWeight" class="block text-sm font-medium">Weight (kg)</label>
                <input type="number" id="fishWeight" placeholder="Enter weight" class="mt-1 block w-full px-3 py-2 rounded-md">
            </div>
            <button type="submit" class="w-full py-2 px-4 rounded-lg hover:shadow-lg" style="background: linear-gradient(to right, #8B0000, #B22222);">Submit</button>
        </form>
    </div>

    <!-- Left Column: Fish Freshness Detector (Moved to the Center) -->
    <div class="bg-[#1E1E1E] mt-10 shadow-box rounded-3xl p-6 hover:bg-[#2B2B2B] transition-all duration-500">
    <h1 class="text-center text-5xl font-bold mb-10 mt-10 pulse-effect" 
        style="color: #FFFFFF; text-shadow: 0 0 30px rgba(255, 255, 255, 1), 0 0 40px rgba(255, 255, 255, 0.9);">
        AquaGrade
    </h1>

    <style>
        @keyframes pulse {
            0% {
                text-shadow: 0 0 30px rgba(255, 255, 255, 1), 0 0 40px rgba(255, 255, 255, 0.9);
            }
            50% {
                text-shadow: 0 0 50px rgba(255, 255, 255, 1), 0 0 70px rgba(255, 255, 255, 1);
            }
            100% {
                text-shadow: 0 0 30px rgba(255, 255, 255, 1), 0 0 40px rgba(255, 255, 255, 0.9);
            }
        }

        .pulse-effect {
            animation: pulse 1.2s infinite ease-in-out;
            font-weight: 900; /* Make the text bolder to enhance visibility */
        }
    </style>




        <!-- Option Tabs -->
        <div class="mb-4 flex justify-between shadow-lg">
            <button id="videoTab" class="tab-button active w-1/4 py-2 px-4 rounded-l-lg">Real-time</button>
            <button id="uploadTab" class="tab-button w-1/4 py-2 px-4">Upload</button>
            <button id="captureTab" class="tab-button w-1/4 py-2 px-4">Capture</button>
            <button id="batchTab" class="tab-button w-1/4 py-2 px-4 rounded-r-lg">Batch</button>
        </div>

        <!-- Real-time Video Section -->
        <div id="videoSection">
            <label class="mt-8 mb-5 ml-2 block text-sm font-medium">
                Real-time video analysis
                <span class="info-icon" data-info="Analyze video frames in real-time from your webcam.">i</span>
            </label>

            <button id="startVideo" 
                class="w-full py-2 px-4 rounded-2xl mt-2 hover:shadow-lg" 
                style="background: linear-gradient(to right, #8B0000, #B22222);">
                Start Real-time Analysis
            </button>

            <!-- Hidden Real-Time Video Stream -->
            <div class="flex justify-center mt-10">
                <video id="videoStream" autoplay class="rounded-lg shadow-lg" style="width: 80%; max-width: 800px; height: auto;"></video>
            </div>

            <div class="flex justify-center mt-10">
                <label class="block text-lg font-semibold text-center mb-2">
                    Inference Result:
                </label>
            </div>

            <!-- Inference Result -->
            <div class="flex justify-center">
                <pre id="videoResultData" 
                    class="p-4 rounded-lg overflow-auto text-sm shadow-lg" 
                    style="width: 80%; max-width: 800px; background-color: #1F1F1F; color: #FF7F7F;">
                </pre>
            </div>
        </div>

        <!-- Upload Image Section -->
        <form id="uploadForm" enctype="multipart/form-data" class="hidden">
            <div class="mb-4">
                <label for="file" class="block mt-8 mb-5 ml-2 text-sm font-medium">
                    Upload an image
                    <span class="info-icon" data-info="Upload a single image from your device for freshness detection.">i</span>
                </label>
                <input type="file" id="file" name="file" accept="image/*" class="mt-1 block w-full px-3 py-2 rounded-md shadow-lg">
            </div>
            <button type="submit" class="w-full py-2 px-4 rounded-2xl hover:shadow-lg" style="background: linear-gradient(to right, #8B0000, #B22222);">Upload Image</button>
        </form>

        <!-- Capture Image Section -->
        <div id="captureSection" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-5">
                Capture an image
                <span class="info-icon" data-info="Use this feature to capture an image directly from your webcam. Ensure camera permissions are granted.">i</span>
            </label>
            <button id="startWebcam" class="w-full py-2 px-4 bg-black text-white rounded-lg hover:bg-gray-900 shadow-lg mt-2" style="font-family: 'Clash Display', sans-serif;background: linear-gradient(to right, #8B0000, #B22222);">Start Webcam</button>
            <video id="webcam" autoplay class="mt-4 w-full rounded-lg shadow-lg hidden"></video>
            <canvas id="snapshot" class="hidden"></canvas>
            <button id="capture" class="w-full py-2 px-4 bg-black text-white rounded-lg mt-2 hover:bg-gray-900 shadow-lg hidden">Capture Image</button>
        </div>

        <!-- Batch Upload Section -->
        <form id="batchForm" enctype="multipart/form-data" class="hidden">
            <div class="mb-4">
                <label for="files" class="block text-sm mt-8 mb-5 ml-2 font-medium">
                    Upload multiple images
                    <span class="info-icon" data-info="Upload multiple images for batch processing.">i</span>
                </label>
                <input type="file" id="files" name="files" accept="image/*" multiple class="mt-1 block w-full px-3 py-2 rounded-md shadow-lg">
            </div>
            <button type="submit" class="w-full py-2 px-4 rounded-2xl hover:shadow-lg" style="background: linear-gradient(to right, #8B0000, #B22222);">Upload Batch</button>
        </form>

        <!-- Result Display -->
        <div id="resultDiv" class="mt-4 hidden">
            <h2 class="text-lg font-semibold">Inference Result:</h2>
            <pre id="resultData" class="p-4 rounded-lg overflow-auto text-sm shadow-lg"></pre>
        </div>
    </div>

        <!-- Right Column: Charts -->
    <div class="min-h-screen grid grid-cols-1 md:grid-cols-3 gap-6 p-6">
        <!-- Right Column: Charts -->
        <div class="mt-20 bg-gradient-to-br from-[#333333] to-[#444444] shadow-box rounded-3xl p-6 md:col-span-3">
            <h2 class="text-center mt-10 text-5xl font-bold mb-4">Charts</h2>

            <!-- Moving Pie Chart -->
            <div class="mt-20 pie-chart-container">
                <canvas id="pieChart"></canvas>
            </div>

            <!-- Reactive Line Chart -->
            <div class="chart-container mt-4">
                <canvas id="lineChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Pie Chart Configuration
        const ctxPie = document.getElementById('pieChart').getContext('2d');
        const pieChart = new Chart(ctxPie, {
            type: 'doughnut',
            data: {
                labels: ['Fresh', 'Not Fresh'], // Pie chart labels
                datasets: [{
                    label: 'Freshness Distribution',
                    data: [70, 30], // Initial data
                    backgroundColor: [
                        '#4CAF50', // Green for Fresh
                        ctxPie.createLinearGradient(0, 0, 0, 400) // Gradient for Not Fresh
                    ],
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: '#FFFFFF' } }
                }
            }
        });

        // Add gradient color to pie chart's "Not Fresh"
        const gradientPie = ctxPie.createLinearGradient(0, 0, 0, 400);
        gradientPie.addColorStop(0, '#FF0000');
        gradientPie.addColorStop(1, '#FFFFFF');
        pieChart.data.datasets[0].backgroundColor[1] = gradientPie; // Apply gradient for Not Fresh
        pieChart.update();

        // Line Chart Configuration
        const ctxLine = document.getElementById('lineChart').getContext('2d');
        const gradientLine = ctxLine.createLinearGradient(0, 0, 400, 0);
        gradientLine.addColorStop(0, '#FF0000');
        gradientLine.addColorStop(1, '#FFFFFF');

        const lineChart = new Chart(ctxLine, {
            type: 'line',
            data: {
                labels: ['1s', '2s', '3s', '4s', '5s', '6s', '7s'], 
                datasets: [{
                    label: 'Freshness Over Time',
                    data: [10, 12, 14, 18, 22, 20, 25], // Example initial data
                    borderColor: gradientLine,
                    backgroundColor: 'rgba(255, 0, 0, 0.2)', // Light red for gradient area
                    tension: 0.4,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { ticks: { color: '#E0E0E0' } },
                    y: { ticks: { color: '#E0E0E0' } }
                },
                plugins: {
                    legend: { labels: { color: '#FFFFFF' } }
                }
            }
        });

        // Function to simulate real-time data updates
        function updateCharts() {
            const newLabel = `${lineChart.data.labels.length + 1}s`;
            const newData = Math.floor(Math.random() * 50);

            // Update Line Chart
            lineChart.data.labels.push(newLabel);
            lineChart.data.datasets[0].data.push(newData);
            lineChart.update();

            // Simulate Pie Chart Updates
            const freshValue = Math.floor(Math.random() * 100);
            const notFreshValue = 100 - freshValue;
            pieChart.data.datasets[0].data = [freshValue, notFreshValue];
            pieChart.update();
        }

        // Simulate updates every 3 seconds
        setInterval(updateCharts, 3000);
    </script>
    </div>

    <script>
        // Original JavaScript logic provided
        const uploadForm = document.getElementById('uploadForm');
        const batchForm = document.getElementById('batchForm');
        const resultDiv = document.getElementById('resultDiv');
        const resultData = document.getElementById('resultData');
        const videoResultData = document.getElementById('videoResultData');
        const captureSection = document.getElementById('captureSection');
        const videoSection = document.getElementById('videoSection');
        const webcam = document.getElementById('webcam');
        const videoStream = document.getElementById('videoStream');
        const snapshot = document.getElementById('snapshot');
        const capture = document.getElementById('capture');
        const startWebcam = document.getElementById('startWebcam');
        const startVideo = document.getElementById('startVideo');
        const uploadTab = document.getElementById('uploadTab');
        const captureTab = document.getElementById('captureTab');
        const batchTab = document.getElementById('batchTab');
        const videoTab = document.getElementById('videoTab');

        let streaming = false;

        // Tab Switching
        const allTabs = [uploadTab, captureTab, batchTab, videoTab];
        const sections = [uploadForm, captureSection, batchForm, videoSection];

        allTabs.forEach((tab, index) => {
            tab.addEventListener('click', () => {
                sections.forEach((section, i) => {
                    if (index === i) {
                        section.classList.remove('hidden');
                        allTabs[i].classList.add('active');
                    } else {
                        section.classList.add('hidden');
                        allTabs[i].classList.remove('active');
                    }
                });
                resultDiv.classList.add('hidden'); // Hide result when switching tabs
            });
        });

        // Start Webcam
        startWebcam.addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                webcam.srcObject = stream;
                webcam.classList.remove('hidden');
                capture.classList.remove('hidden');
            } catch (error) {
                console.error('Webcam access error:', error);
                alert('Failed to access the camera. Please allow permissions and try again.');
            }
        });

        // Capture Image
        capture.addEventListener('click', () => {
            const context = snapshot.getContext('2d');
            snapshot.width = webcam.videoWidth;
            snapshot.height = webcam.videoHeight;
            context.drawImage(webcam, 0, 0, snapshot.width, snapshot.height);

            snapshot.toBlob(async (blob) => {
                const formData = new FormData();
                formData.append('file', blob, 'snapshot.jpg');

                try {
                    const response = await fetch('/upload-single-image', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error('Upload failed.');
                    }

                    const data = await response.json();
                    resultData.textContent = JSON.stringify(data, null, 2);
                    resultDiv.classList.remove('hidden');
                } catch (error) {
                    console.error('Error uploading snapshot:', error);
                    alert('Snapshot upload failed.');
                }
            }, 'image/jpeg');
        });

        // Upload Form Submission
        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(uploadForm);

            try {
                const response = await fetch('/upload-single-image', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Failed to upload image.');
                }

                const data = await response.json();
                resultData.textContent = JSON.stringify(data, null, 2);
                resultDiv.classList.remove('hidden');
            } catch (error) {
                console.error('Error:', error);
            }
        });

        // Batch Form Submission
        batchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(batchForm);

            try {
                const response = await fetch('/upload-batch-images', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Failed to upload batch.');
                }

                const data = await response.json();
                resultData.textContent = JSON.stringify(data, null, 2);
                resultDiv.classList.remove('hidden');
            } catch (error) {
                console.error('Error:', error);
            }
        });

        // Start Real-Time Video Analysis
        startVideo.addEventListener('click', async () => {
            if (!streaming) {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                videoStream.srcObject = stream;
                streaming = true;
                analyzeFrame();
            }
        });

        async function analyzeFrame() {
            if (!streaming) return;

            const videoCanvas = document.createElement('canvas');
            videoCanvas.width = 640;
            videoCanvas.height = (640 / videoStream.videoWidth) * videoStream.videoHeight;
            const videoContext = videoCanvas.getContext('2d');
            videoContext.drawImage(videoStream, 0, 0, videoCanvas.width, videoCanvas.height);

            videoCanvas.toBlob(async (blob) => {
                const formData = new FormData();
                formData.append('file', blob, 'frame.jpg');

                try {
                    const response = await fetch('/upload-single-image', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }

                    const data = await response.json();
                    videoResultData.textContent = JSON.stringify(data, null, 2);
                } catch (error) {
                    console.error('Error:', error);
                }
            }, 'image/jpeg');

            setTimeout(analyzeFrame, 500); // Process a frame every 500ms
        }
    </script>
</body>
</html>
